select txt.sql_text,new.sql_id,new_hash,old_hash,new_execs, old_execs,new_gets,old_gets,new_reads,old_reads, new_cpu,old_cpu,new_min_snap, old_min_snap,new_max_snap,old_max_snap from (select st_n.sql_id,st_n.plan_hash_value new_hash,sum(st_n.executions_delta) new_execs,sum(st_n.buffer_Gets_delta) new_gets, sum(st_n.disk_reads_delta) new_reads,sum(st_n.cpu_time_delta) new_cpu,min(snp.begin_interval_time) new_min_snap, max(snp.begin_interval_time) new_max_snap from dba_hist_sqlstat st_n join dba_hist_snapshot snp on st_n.snap_id=snp.snap_id where (st_n.sql_id, st_n.plan_hash_value) in (select pl.sql_id,pl.plan_hash_value from dba_hist_sql_plan pl where object_name='INDEX NAME' and object_owner='INDEX OWNER') group by st_n.sql_id,st_n.plan_hash_value) new join (select st_o.sql_id,st_o.plan_hash_value old_hash,sum(st_o.executions_delta) old_execs,sum(st_o.buffer_Gets_delta) old_gets, sum(st_o.disk_reads_delta) old_reads,sum(st_o.cpu_time_delta) old_cpu,min(snp.begin_interval_time) old_min_snap, max(snp.begin_interval_time) old_max_snap from dba_hist_sqlstat st_o join dba_hist_snapshot snp on st_o.snap_id=snp.snap_id where (st_o.sql_id, st_o.plan_hash_value) not in (select pl.sql_id,pl.plan_hash_value from dba_hist_sql_plan pl where object_name='INDEX NAME' and object_owner='INDEX OWNER') group by st_o.sql_id,st_o.plan_hash_value) old on new.sql_id = old.sql_id join dba_hist_sqltext txt on txt.sql_id = new.sql_id